const AutoTranslator=function(window,$){const locoConf=window.locoConf||{},configData=window.extradata||{};let translationPerformed=!1;const{ajax_url:ajaxUrl,nonce:nonce,LCAT_URL:LCAT_URL,extra_class:rtlClass,api_key:apikey,dashboard_url:dashboardurl}=configData,allStrings=locoConf.conf.podata;let pluginOrThemeName="";if(locoConf&&locoConf.conf&&locoConf.conf.project&&locoConf.conf.project.bundle){const isTheme=locoConf.conf.project.bundle.startsWith("theme.");if(isTheme)pluginOrThemeName=locoConf.conf.project.domain||"";else{const match=locoConf.conf.project.bundle.match(/^[^.]+\.(.*?)(?=\/)/);pluginOrThemeName=match?match[1]:""}}function onLoad(){if(locoConf&&locoConf.conf){const{conf:conf}=locoConf;allStrings.shift();const{locale:locale,project:project}=conf,projectId=generateProjectId(project,locale);createStringsModal(projectId,"ChromeAiTranslator"),addStringsInModal(allStrings)}}function initialize(){const{conf:conf}=locoConf,{locale:locale,project:project}=conf,projectId=generateProjectId(project,locale);0===$("#loco-editor nav").find("#cool-auto-translate-btn").length&&addAutoTranslationBtn(),settingsModel(),$("#cool-auto-translate-btn").on("click",openSettingsModel),$("button.icon-robot[data-loco='auto']").on("click",openTranslationProviderModel),$("#ChromeAiTranslator_settings_btn").on("click",(function(){openChromeAiTranslatorModel(locale)})),$(".lcat_save_strings").on("click",onSaveClick)}function addStringsInModal(allStrings){var plainStrArr=filterRawObject(allStrings,"plain");plainStrArr.length>0?printStringsInPopup(plainStrArr,type="ChromeAiTranslator"):($(".notice-container").addClass("notice inline notice-warning").html("There is no plain string available for translations."),$(".lcat_string_container, .choose-lang, .lcat_save_strings, .translator-widget, .notice-info, .is-dismissible").hide())}function generateProjectId(project,locale){const{domain:domain}=project||{},{lang:lang,region:region}=locale;return project?`${domain}-${lang}-${region}`:`temp-${lang}-${region}`}async function openChromeAiTranslatorModel(locale){var defaultcode=locale.lang?locale.lang:null;switch(defaultcode){case"bel":defaultlang="be";break;case"he":defaultlang="iw";break;case"snd":defaultlang="sd";break;case"jv":defaultlang="jw";break;case"nb":case"nn":defaultlang="no";break;default:defaultlang=defaultcode}let modelContainer=$("div#ChromeAiTranslator-widget-model.ChromeAiTranslator-widget-container");modelContainer.find(".lcat_actions > .lcat_save_strings").prop("disabled",!0),modelContainer.find(".lcat_stats").hide(),$("#lcat-dialog").dialog("close"),modelContainer.fadeIn("slow")}function onSaveClick(){let translatedObj=[],type=this.getAttribute("data-type"),total_character_count=0,total_word_count=0;const rpl={'"% s"':'"%s"','"% d"':'"%d"','"% S"':'"%s"','"% D"':'"%d"',"% s":" %s ","% S":" %s ","% d":" %d ","% D":" %d ","Ùª s":" %s ","Ùª S":" %s ","Ùª d":" %d ","Ùª D":" %d ","Ùª Ø³":" %s ","%S":" %s ","%D":" %d ","% %":"%%"},regex=/(\%\s*\d+\s*\$?\s*[a-z0-9])/gi;$("."+type+"-widget-body").find(".lcat_strings_table tbody tr").each((function(){const source=$(this).find("td.source").text(),target=$(this).find("td.target").text(),improvedTargetrpl=strtr(target,rpl),improvedSourcerpl=strtr(source,rpl),improvedTarget=improvedTargetrpl.replace(regex,(function(match){return match.replace(/\s/g,"").toLowerCase()})),improvedSource=improvedSourcerpl.replace(regex,(function(match){return match.replace(/\s/g,"").toLowerCase()}));total_character_count+=improvedSource.length,total_word_count+=improvedSource.split(/\s+/).length,translatedObj.push({source:improvedSource,target:improvedTarget})}));const container=$(this).closest(".lcat_custom_model"),translationProvider=container.data("translation-provider"),translationTime=container.data("translation-time"),{lang:lang,region:region}=locoConf.conf.locale,target_language=region?`${lang}_${region}`:lang,totalCharacters=translatedObj.reduce((sum,item)=>sum+item.source.length,0),totalStrings=translatedObj.length,translationData={time_taken:translationTime,translation_provider:translationProvider,character_count:totalCharacters,string_count:totalStrings,pluginORthemeName:pluginOrThemeName,target_language:target_language};var projectId=$(this).parents(".lcat_custom_model").find("#project_id").val();saveTranslatedStrings(translatedObj,projectId,translationData),$(".lcat_custom_model").fadeOut("slow"),$("html").addClass("merge-translations"),updateLocoModel()}function updateLocoModel(){var checkModal=setInterval((function(){var locoModel=$(".loco-modal"),locoModelApisBatch=$(".loco-modal #loco-apis-batch");if(locoModel.length&&locoModel.attr("style").indexOf("none")<=-1&&locoModel.find("#loco-job-progress").length){$("html").removeClass("merge-translations"),locoModelApisBatch.find("a.icon-help, a.icon-group, #loco-job-progress").hide(),locoModelApisBatch.find("select#auto-api").hide();var currentState=$("select#auto-api option[value='loco_auto']").prop("selected","selected");locoModelApisBatch.find("select#auto-api").val(currentState.val()),locoModel.find(".ui-dialog-titlebar .ui-dialog-title").html("Step 3 - Add Translations into Editor and Save"),locoModelApisBatch.find("button.button-primary span").html("Start Adding Process"),locoModelApisBatch.find("button.button-primary").on("click",(function(){$(this).find("span").html("Adding...")})),locoModel.addClass("addtranslations"),$(".noapiadded").remove(),locoModelApisBatch.find("form").show(),locoModelApisBatch.removeClass("loco-alert"),clearInterval(checkModal)}}),200)}function openTranslationProviderModel(e){if(void 0!==e.originalEvent)var checkModal=setInterval((function(){var locoModal=$(".loco-modal"),locoBatch=locoModal.find("#loco-apis-batch"),locoTitle=locoModal.find(".ui-dialog-titlebar .ui-dialog-title"),opt;locoBatch.length&&!locoModal.is(":hidden")&&(locoModal.removeClass("addtranslations"),locoBatch.find("select#auto-api").show(),locoBatch.find("a.icon-help, a.icon-group").show(),locoBatch.find("#loco-job-progress").show(),locoTitle.html("Auto-translate this file"),locoBatch.find("button.button-primary span").html("Translate"),1===locoBatch.find("select#auto-api option").length&&(locoBatch.find(".noapiadded").remove(),locoBatch.removeClass("loco-alert"),locoBatch.find("form").hide(),locoBatch.addClass("loco-alert"),locoTitle.html("No translation APIs configured"),locoBatch.append("<div class='noapiadded'>\n                            <p>Add automatic translation services in the plugin settings.<br>or<br>Use <strong>Auto Translate</strong> addon button.</p>\n                            <nav>\n                                <a href='http://locotranslate.local/wp-admin/admin.php?page=loco-config&amp;action=apis' class='button button-link has-icon icon-cog'>Settings</a>\n                                <a href='https://localise.biz/wordpress/plugin/manual/providers' class='button button-link has-icon icon-help' target='_blank'>Help</a>\n                                <a href='https://localise.biz/wordpress/translation?l=de-DE' class='button button-link has-icon icon-group' target='_blank'>Need a human?</a>\n                            </nav>\n                        </div>")),clearInterval(checkModal))}),100)}function filterRawObject(rawArray,filterType){return rawArray.filter(item=>!(!item.source||item.target)&&(!(ValidURL(item.source)||isHTML(item.source)||isSpecialChars(item.source)||isEmoji(item.source)||item.source.includes("#"))&&(isPlacehodersChars(item.source),!0)))}function ValidURL(str){var pattern;return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(str)}function isHTML(str){var rgex;return/<(?=.*? .*?\/ ?>|br|hr|input|!--|wbr)[a-z]+.*?>|<([a-z]+).*?<\/\1>/i.test(str)}function isSpecialChars(str){var rgex;return/[@^{}|<>]/g.test(str)}function isEmoji(str){var ranges=["(?:[âœ€-âž¿]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[#-9]ï¸?âƒ£|ãŠ™|ãŠ—|ã€½|ã€°|â“‚|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|ðŸ†Ž|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|[\ud83c[\ude01-\ude02]|ðŸˆš|ðŸˆ¯|[\ud83c[\ude32-\ude3a]|[\ud83c[\ude50-\ude51]|â€¼|â‰|[â–ª-â–«]|â–¶|â—€|[â—»-â—¾]|Â©|Â®|â„¢|â„¹|ðŸ€„|[â˜€-â›¿]|â¬…|â¬†|â¬‡|â¬›|â¬œ|â­|â­•|âŒš|âŒ›|âŒ¨|â|[â©-â³]|[â¸-âº]|ðŸƒ|â¤´|â¤µ|[â†-â‡¿])"];return str.match(ranges.join("|"))}function isPlacehodersChars(str){var rgex;return/%s|%d/g.test(str)}function strtr(s,p,r){return!!s&&{2:function(){for(var i in p)s=strtr(s,i,p[i]);return s},3:function(){return s.replace(RegExp(p,"g"),r)},0:function(){}}[arguments.length]()}function saveTranslatedStrings(translatedStrings,projectId,translationData){if(translatedStrings&&translatedStrings.length>0){const batchSize=2500;for(let i=0;i<translatedStrings.length;i+=batchSize){const batch=translatedStrings.slice(i,i+batchSize),part=`-part-${Math.ceil(i/batchSize)}`;sendBatchRequest(batch,projectId,part,translationData)}}}function sendBatchRequest(stringData,projectId,part,translationData){const data={action:"save_all_translations",data:JSON.stringify(stringData),part:part,"project-id":projectId,wpnonce:nonce,translation_data:JSON.stringify(translationData)};$.ajax({url:ajaxUrl,method:"POST",data:data,dataType:"json",success:function(response){$('#loco-editor nav button[data-loco="auto"]').trigger("click")},error:function(xhr,status,error){console.error(error)}})}function addAutoTranslationBtn(){const existingBtn=$("#loco-editor nav").find("#cool-auto-translate-btn");existingBtn.length>0&&existingBtn.remove();const locoActions=$("#loco-editor nav").find("#loco-actions"),autoTranslateBtn=$('<fieldset><button id="cool-auto-translate-btn" class="button has-icon icon-translate">Auto Translate</button></fieldset>');locoActions.append(autoTranslateBtn)}function openSettingsModel(){$("#lcat-dialog").dialog({dialogClass:rtlClass,resizable:!1,height:"auto",width:400,modal:!0,draggable:!1,buttons:{Cancel:function(){$(this).dialog("close")}}})}onLoad();var modals=document.querySelectorAll(".lcat_custom_model");function encodeHtmlEntity(str){for(var buf=[],i=str.length-1;i>=0;i--)buf.unshift(["&#",str[i].charCodeAt(),";"].join(""));return buf.join("")}function printStringsInPopup(jsonObj,type){let html="",totalTChars=0,index=1,custom_attr="";if(jsonObj){for(const key in jsonObj)if(jsonObj.hasOwnProperty(key)){const element=jsonObj[key],sourceText=element.source.trim();if(""!==sourceText&&"ChromeAiTranslator"==type){html+=`<tr id="${key}"><td>${index}</td><td class="notranslate source">${encodeHtmlEntity(sourceText)}</td>`,html+="ChromeAiTranslator"==type?`<td     class="target translate">${sourceText}</td></tr>`:'<td class="target translate"></td></tr>';const div=document.createElement("div");div.innerHTML=sourceText,index++,totalTChars+=div.innerText.length}}$(".lcat_stats").each((function(){$(this).find(".totalChars").html(totalTChars)}))}$("#"+type+"-widget-model").find(".lcat_strings_table > tbody.lcat_strings_body").html(html)}function settingsModel(){const icons={chrome:extradata.chromeAi_preview,docs:extradata.document_preview,error:extradata.error_preview},url="https://locoaddon.com/docs/",LCAT_IMG=key=>LCAT_URL+"assets/images/"+icons[key],DOC_ICON_IMG=`<img src="${LCAT_IMG("docs")}" width="20" alt="Docs">`,rows=[{name:"Chrome Built-in AI",icon:"chrome",info:"https://developer.chrome.com/docs/ai/translator-api",doc:"https://developer.chrome.com/docs/ai/translator-api",btn:`\n                    <button id="ChromeAiTranslator_settings_btn" class="lcat-provider-btn translate">Translate</button>\n                    <button id="lcat-chromeai-disabled-message" class="lcat-provider-btn error d-none">\n                        <img src="${LCAT_IMG("error")}" alt="error" style="height:16px; vertical-align:middle; margin-right:5px;">\n                        View Error\n                    </button>\n                    <div id="lcat-chromeai-disabled-message-content" style="display:none;"></div>\n                `}],rowHTML=rows.map(row=>`\n            <tr>\n                <td class="lcat-provider-name">\n                    <a href="${row.info}" target="_blank">\n                        <img src="${LCAT_IMG(row.icon)}" class="lcat-provider-icon" alt="${row.name}">\n                    </a>\n                    ${row.name}\n                </td>\n                <td>${row.btn}</td>\n                 <td>\n                    <a href="${row.doc}" target="_blank" class="lcat-provider-docs-btn">${DOC_ICON_IMG}</a>\n                </td>\n               \n            </tr>\n        `).join(""),modelHTML=`\n            <div class="lcat-provider-modal" id="lcat-dialog" title="Step 2 - Select Translation Provider" style="display:none;">\n                <table class="lcat-provider-table">\n                    <thead>\n                        <tr><th>Name</th><th>Translate</th><th>Docs</th></tr>\n                    </thead>\n                    <tbody>${rowHTML}</tbody>\n                </table>\n            </div>\n        `;$("body").append(modelHTML)}function createStringsModal(projectId,widgetType){let{wrapperCls:wrapperCls,headerCls:headerCls,bodyCls:bodyCls,footerCls:footerCls,modelId:modelId}=getWidgetClasses(widgetType),modelHTML=`\n            <div id="${modelId}" class="modal lcat_custom_model  ${wrapperCls} ${rtlClass}">\n                <div class="modal-content">\n                    <input type="hidden" id="project_id" value="${projectId}"> \n                    ${modelHeaderHTML(widgetType,headerCls)}   \n                    ${modelBodyHTML(widgetType,bodyCls)}   \n                    ${modelFooterHTML(widgetType,footerCls)} \n                    </div>\n                </div>`;$("body").append(modelHTML)}function getWidgetClasses(widgetType){let wrapperCls="",headerCls="",bodyCls="",footerCls="",modelId="";switch(widgetType){case"ChromeAiTranslator":wrapperCls="ChromeAiTranslator-widget-container",headerCls="ChromeAiTranslator-widget-header",bodyCls="ChromeAiTranslator-widget-body",footerCls="ChromeAiTranslator-widget-footer",modelId="ChromeAiTranslator-widget-model",type="ChromeAiTranslator";break;default:wrapperCls="ChromeAiTranslator-widget-container",headerCls="ChromeAiTranslator-widget-header",bodyCls="ChromeAiTranslator-widget-body",footerCls="ChromeAiTranslator-widget-footer"}return{wrapperCls:wrapperCls,headerCls:headerCls,bodyCls:bodyCls,footerCls:footerCls,modelId:modelId,type:type}}function modelBodyHTML(widgetType,bodyCls){const translator_type=`${type}`,capitalizedString=capitalizeFirstLetter(translator_type);function capitalizeFirstLetter(str){return(str=str.replace("ChromeAiTranslator","Chrome AI")).charAt(0).toUpperCase()+str.slice(1)}const HTML=`<div class = "modal-scrollbar">\n        <div class="notice inline notice-info is-dismissible">\n                        Plugin will not translate any strings with HTML or special characters because ${capitalizedString} Translator currently does not support HTML and special characters translations.\n                        You can edit translated strings inside Loco Translate Editor after merging the translations. Only special characters (%s, %d) fixed at the time of merging of the translations.\n                    </div>\n                    <div class="notice inline notice-info is-dismissible">\n                        Machine translations are not 100% correct.\n                        Please verify strings before using on the production website.\n                    </div>\n        <div class="modal-body  ${bodyCls}">\n            <div class="lcat_translate_progress">\n                Automatic translation is in progress....<br/>\n                It will take a few minutes, enjoy â˜• coffee in this time!<br/><br/>\n                Please do not leave this window or browser tab while the translation is in progress...\n\n            <div class="progress-wrapper">\n                <div class="progress-container">\n                    <div class="progress-bar" id="myProgressBar">\n                        <span id="progressText">0%</span>\n                    </div>\n                </div>\n            </div>\n            </div>\n            <div class="lcat_translate_warning-massage">\n                <div class="warning-massage-wrapper">\n                     <button class="close-button">&times;</button>\n                     <div class="warning-massage-content"></div>\n                </div>\n            </div>\n            ${translatorWidget(widgetType)}\n            <div class="lcat_string_container">\n                <table class="scrolldown lcat_strings_table">\n                    <thead>\n                        <th class="notranslate">S.No</th>\n                        <th class="notranslate">Source Text</th>\n                        <th class="notranslate">Translation</th>\n                    </thead>\n                    <tbody class="lcat_strings_body">\n                    </tbody>\n                </table>\n            </div>\n            <div class="notice-container"></div>\n        </div>\n        </div>`;return HTML}function modelHeaderHTML(widgetType,headerCls){if("ChromeAiTranslator"===widgetType){const HTML=`\n        <div class="modal-header  ${headerCls}">\n                        <span class="close">&times;</span>\n                        <h2 class="notranslate">Step 2 - Start Automatic Translation Process</h2>\n                        <div class="lcat_actions">\n                            <button class="notranslate lcat_save_strings button button-primary" data-type = "${type}" disabled="true">Merge Translation</button>\n                        </div>\n                        <div style="display:none" class="lcat_stats hidden">\n                            Wahooo! You have saved your valuable time via auto translating \n                            <strong class="totalChars"></strong> characters  using \n                            <strong>\n                                \n                                    LocoAI â€“ Chrome AI Auto Translator\n                               \n                            </strong>\n                        </div>\n                    </div>\n                    `;return HTML}}function modelFooterHTML(widgetType,footerCls){if("ChromeAiTranslator"===widgetType){const HTML=` <div class="modal-footer ${footerCls}">\n        <div class="lcat_actions">\n            <button class="notranslate lcat_save_strings button button-primary" data-type = "${type}" disabled="true">Merge Translation</button>\n        </div>\n        <div style="display:none" class="lcat_stats">\n            Wahooo! You have saved your valuable time via auto translating \n            <strong class="totalChars"></strong> characters  using \n            <strong>\n               \n                   LocoAI â€“ Chrome AI Auto Translator\n              \n            </strong>\n        </div>\n    </div>`;return HTML}return""}function translatorWidget(widgetType){return"ChromeAiTranslator"===widgetType?`<div class="translator-widget  ${widgetType}">\n                    <h3 class="choose-lang">Translate Using Chrome Built-in AI<div class="lcat_chrome_ai"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><path fill="none" stroke="#5cb85c" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m10 7l-.516 1.394c-.676 1.828-1.014 2.742-1.681 3.409s-1.581 1.005-3.409 1.681L3 14l1.394.516c1.828.676 2.742 1.015 3.409 1.681s1.005 1.581 1.681 3.409L10 21l.516-1.394c.676-1.828 1.015-2.742 1.681-3.409s1.581-1.005 3.409-1.681L17 14l-1.394-.516c-1.828-.676-2.742-1.014-3.409-1.681s-1.005-1.581-1.681-3.409zm8-4l-.221.597c-.29.784-.435 1.176-.72 1.461c-.286.286-.678.431-1.462.72L15 6l.598.221c.783.29 1.175.435 1.46.72c.286.286.431.678.72 1.462L18 9l.221-.597c.29-.784.435-1.176.72-1.461c.286-.286.678-.431 1.462-.72L21 6l-.598-.221c-.783-.29-1.175-.435-1.46-.72c-.286-.286-.431-.678-.72-1.462z" color="#5cb85c"/></svg></div></h3>\n                     <div id="chrome_ai_translator_element"></div>\n                </div>`:""}$(window).click((function(event){event.target.closest(".modal-content");for(var i=0;i<modals.length;i++){var modal=modals[i];$(event.target).hasClass("lcat_custom_model")&&event.target===modal&&(modal.style.display="none",$(".container").length>0&&$(".container").remove())}})),$(".lcat_custom_model").find(".close").on("click",(function(){$(".container").length>0&&$(".container").remove(),$(".lcat_custom_model").fadeOut("slow")})),$(document).ready((function(){initialize()}))}(window,jQuery);